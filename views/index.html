<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
		<meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0' name='viewport' />
		<meta name="viewport" content="width=device-width" />
		<title>SunSmart</title>

		<!--  Fonts and icons     -->
		<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" />
		<link href="/stylesheets/animate.css" rel="stylesheet" />
		<link href="/stylesheets/paper-dashboard.css" rel="stylesheet" />
		<link href="https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css" rel="stylesheet">
		<link href='https://fonts.googleapis.com/css?family=Muli:400,300' rel='stylesheet' type='text/css'>
		<link href="/stylesheets/themify-icons.css" rel="stylesheet">
		<style type="text/css">
			#uvcard {
            background-image: url("/images/uv.png");
            background-repeat: no-repeat;
            background-size: contain;
			}

			#device {
            background-image: url("/images/iot.png");
            background-repeat: no-repeat;
            background-size: cover;
			}

			#healthtip {
            background-image: url("/images/ht.png");
            background-repeat: no-repeat;
            background-size: contain;
			}

			#profile {
            background-image: url("/images/up.png");
            background-repeat: no-repeat;
            background-size: contain;
			}

			.btn-dashboard {
            width: 250px;
            display: inline-block;
			}
		</style>

		<!--   Core JS Files   -->
		<script src="https://code.jquery.com/jquery-3.2.1.js" type="text/javascript"></script>
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" type="text/javascript"></script>

	</head>
	<body>
		<div class="wrapper">
			<div class="sidebar" data-background-color="black" data-active-color="danger">
				<div class="sidebar-wrapper">
					<div class="logo">
						<a href="javascript:window.location.reload()" class="simple-text">
							SunSmart
						</a>
					</div>
					<ul id="menu" class="nav">
						<li id="dashboard" class="da1  active" onclick="changeView(this)">
							<a href="javascript:void(0)">
								<i class="ti-panel"></i>
								<p>Dashboard</p>
							</a>
						</li>
						<li id="devices" class="da2" onclick="changeView(this)">
							<a href="javascript:void(0)">
								<i class="ti-mobile"></i>
								<p>Devices</p>
							</a>
						</li>
						<li id="uvindex" class="da3" onclick="changeView(this)">
							<a href="javascript:void(0)">
								<i class="ti-shine"></i>
								<p>UV Index</p>
							</a>
						</li>
						<li id="healthtips" class="da4" onclick="changeView(this)">
							<a href="javascript:void(0)">
								<i class="ti-info"></i>
								<p>Health Tips</p>
							</a>
						</li>
						<li id="userprofile" class="da5" onclick="changeView(this)">
							<a href="javascript:void(0)">
								<i class="ti-user"></i>
								<p>User Profile</p>
							</a>
						</li>
					</ul>
				</div>
			</div>

			<div class="main-panel">
				<nav class="navbar navbar-default">
					<div class="container-fluid">
						<div class="navbar-header">
							<button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#menu-collapse">
								<span class="sr-only">Toggle navigation</span>
								<span class="icon-bar bar1"></span>
								<span class="icon-bar bar2"></span>
								<span class="icon-bar bar3"></span>
							</button>
							<a class="navbar-brand" href="javascript:void(0)">Dashboard</a>
						</div>
						<div id="menu-collapse" class="collapse navbar-collapse">
							<ul class="nav navbar-nav navbar-right">
								<li>
									<a href="javascript:void(0)">
										<i class="ti-panel"></i>
										<p>Logout</p>
									</a>
								</li>
							</ul>
						</div>
					</div>
				</nav>

				<div class="content">
					<div class="container-fluid">

						<div id="dashboard-content">
							<div class="row">
								<div class="col-lg-4 col-sm-4">
									<div class="card">
										<div class="content">
											<div class="row">
												<div class="col-xs-5">
													<div class="icon-big icon-warning text-center" id="device">
													</div>
												</div>
												<div class="col-xs-7">
													<div class="numbers">
														<p>DEVICES</p>
													</div>
												</div>
											</div>
											<div class="footer">
												<hr />
												<div class="stats">
													<button class="btn btn-dashboard" onclick="change(1)">Get Started</button>
												</div>
											</div>
										</div>
									</div>
								</div>
								<div class="col-lg-4 col-sm-4">
									<div class="card">
										<div class="content">
											<div class="row">
												<div class="col-xs-5">
													<div class="icon-big icon-success text-center" id="uvcard">
													</div>
												</div>
												<div class="col-xs-7">
													<div class="numbers">
														<p>UV INDEX</p>
													</div>
												</div>
											</div>
											<div class="footer">
												<hr />
												<div class="stats">
													<button class="btn btn-dashboard" onclick="change(2)">Get UV Index</button>
												</div>
											</div>
										</div>
									</div>
								</div>
								<div class="col-lg-4 col-sm-4">
									<div class="card">
										<div class="content">
											<div class="row">
												<div class="col-xs-5">
													<div class="icon-big icon-danger text-center" id="healthtip">
														<i></i>
													</div>
												</div>
												<div class="col-xs-7">
													<div class="numbers">
														<p>HEALTH TIPS!</p>
													</div>
												</div>
											</div>
											<div class="footer">
												<hr />
												<div class="stats">
													<button class="btn btn-dashboard" onclick="change(3)">Get Health Tips</button>
												</div>
											</div>
										</div>
									</div>
								</div>
								<div class="col-lg-4 col-sm-4">
									<div class="card">
										<div class="content">
											<div class="row">
												<div class="col-xs-5">
													<div class="icon-big icon-info text-center" id="profile">
													</div>
												</div>
												<div class="col-xs-7">
													<div class="numbers">
														<p>USER PROFILE</p>
													</div>
												</div>
											</div>
											<div class="footer">
												<hr />
												<div class="stats">
													<button class="btn btn-dashboard" onclick="change(4)">My Profile</button>
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>

						<div id="devices-content" style="display:none">
							<div class="row">
								<div id="Nodevice">
									<div class="row">
										<div class="col-lg-6 col-sm-6">
											<div class="card">
												<div class="container-fluid" style="padding: 25px">
													<strong>No Devices Found. Please Add a device to get started.</strong>
												</div>
											</div>
										</div>
									</div>
								</div>
								<div id="registeredDevices">
									<div class="row" id="registeredDevices-content">
									</div>
								</div>
							</div>
							<div class="row" style="text-align: center">
								<button id="addDeviceBtn" type="button" class="btn btn-info" data-toggle="modal" data-target="#registerModal">Add Device</button>
							</div>
						</div>

						<div id="uvindex-content" style="display:none">
							<div class="row">
								<div id="NodeviceData">
									<div class="row">
										<div class="col-lg-6 col-sm-6">
											<div class="card">
												<div class="container-fluid" style="padding: 25px">
													<strong>No Device-data Found. Please Add a device to get started.</strong>
												</div>
											</div>
										</div>
									</div>
								</div>
								<div id="deviceData">
									<div class="row" id="deviceData-content">
									</div>
								</div>
							</div>
							<div class="row" style="text-align: center">
								<button id="getLatestBtn" type="button" class="btn btn-info" onclick="latestDevicedata()">Get Latest Data</button>
							</div>
						</div>

						<div id="healthtips-content" style="display:none">
							<div class="row">
								<div class="col-lg-6 col-sm-6">
									<div class="card">
										<div class="header">
											Health tips.
										</div>
										<div class="content">
											<p>
												Health tips links.
											</p>
										</div>
									</div>
								</div>
							</div>
						</div>

						<div id="userprofile-content" style="display:none">
							<div class="row">
								<div class="col-lg-6 col-sm-6">
									<div class="card">
										<div class="header">
											User Details
										</div>
										<div class="content">
											<p>
												Name <br />
												Email <br />
											</p>
										</div>
									</div>
								</div>
							</div>
						</div>

					</div>
				</div>

				<!-- Here comes the footer-->
				<footer class="footer">
					<div class="container-fluid">
						<nav class="pull-left">
							<ul>
								<li>
									<a href="https://github.com/Ganeshr93">
										GitHub
									</a>
								</li>
							</ul>
						</nav>
						<div class="copyright pull-right">
							&copy;
							<script>document.write(new Date().getFullYear())</script>, made with <i class="fa fa-heart heart"></i> by SunSmart Inc
						</div>
					</div>
				</footer>
			</div>
		</div>

		<!-- Modal for Register Device-->
		<div id="registerModal" class="modal fade" role="dialog">
			<div class="modal-dialog modal-sm">
				<!-- Modal content-->
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal">&times;</button>
						<h4 class="modal-title">Device register form</h4>
					</div>
					<div class="modal-body">
						<form>
							<div class="form-group">
								<label for="deviceid">DeviceID</label>
								<input name="deviceid" type="text" class="form-control" id="deviceid" placeholder="Device Id" required="required">
							</div>
							<div id="registerdevice-error" style="color: red; margin: 3px 0px 3px 0px">
							</div>
							<button type="button" id="register-submit" class="btn btn-primary">Submit</button>
							<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
						</form>
					</div>
					<div class="modal-footer">
					</div>
				</div>
			</div>
		</div>

		<script src="/js/paper-dashboard.js"></script>

		<script>
			var userEmail = '{{{email}}}';
			var deviceId = '';

			$(document).ready(function () {
				loadContent();
				getDevices();
			});

			function change(x) {
				if(x==1) {
					var element = document.getElementById("devices");
					changeView(element);
				}
				else if(x==2) {
					var element = document.getElementById("uvindex");
					changeView(element);
				}
				else if(x==3) {
					var element = document.getElementById("healthtips");
					changeView(element);
				}
				else if(x==4) {
					var element = document.getElementById("userprofile");
					changeView(element);
				}
			}

			function changeView(event) {
				var listactive = document.getElementsByClassName('active');

				if (listactive.length > 0) {
					var flagActive = true;
					while (flagActive) {
						listactive = document.getElementsByClassName('active');
						for (var i = 0; i < listactive.length; i++) {
							listactive[i].className = listactive[i].className.replace(/\active\b/g, "");
						}

						var isEmpty = document.getElementsByClassName('active');
						if (isEmpty.length == 0) {
							flagActive = false;
						}
					}
				}

				var classes = document.getElementsByClassName(event.className.split(' ')[0]);
				for (var i = 0; i < classes.length; i++) {
					classes[i].className += " active";
				}

				loadContent(event.id);
			}

			function loadContent(id) {
				switch (id) {
					case 'dashboard':
                    $('#devices-content').hide();
                    $('#userprofile-content').hide();
                    $('#uvindex-content').hide();
                    $('#healthtips-content').hide();
                    $('#dashboard-content').show();
                    break;
					case 'devices':
                    $('#dashboard-content').hide();
                    $('#userprofile-content').hide();
                    $('#uvindex-content').hide();
                    $('#healthtips-content').hide();
                    $('#devices-content').show();
                    break;
					case 'healthtips':
                    $('#devices-content').hide();
                    $('#dashboard-content').hide();
                    $('#uvindex-content').hide();
                    $('#userprofile-content').hide();
                    $('#healthtips-content').show();
                    break;
					case 'uvindex':
                    $('#devices-content').hide();
                    $('#dashboard-content').hide();
                    $('#healthtips-content').hide();
                    $('#userprofile-content').hide();
                    $('#uvindex-content').show();
                    break;
					case 'userprofile':
                    $('#devices-content').hide();
                    $('#dashboard-content').hide();
                    $('#uvindex-content').hide();
                    $('#healthtips-content').hide();
                    $('#userprofile-content').show();
                    break;
					default:
                    $('#devices-content').hide();
                    $('#userprofile-content').hide();
                    $('#uvindex-content').hide();
                    $('#healthtips-content').hide();
                    $('#dashboard-content').show();
				}
			}

			$('#addDeviceBtn').on('click', function () {
				$('#registerdevice-error').html('');
				$("#deviceid").val('');
			});

			$('#register-submit').on('click', function () {
				var url = 'http://ec2-13-59-250-78.us-east-2.compute.amazonaws.com/register';
				var data = {
					deviceId: $("#deviceid").val(),
					email: userEmail
				}

				$.ajax({
					type: "POST",
					url: url,
					dataType: "json",
					data: data,
					success: AppendRegisteredDevice,
					error: function (jqXHR) {
						var error = jqXHR.responseJSON.error;
						$('#registerdevice-error').html(error);
					}
				});

				deviceId=$("#deviceid").val();
			});

			function AppendRegisteredDevice(msg) {
				deviceId=msg.deviceId; //TODO: Need to modify this.
				$('#registerModal').modal('hide');
				$('#Nodevice').hide();
				var htmldata = '<div class="col-lg-6 col-sm-6"><div class="card"><div class="container-fluid" style="padding: 15px">';
				htmldata += '<form>';
				htmldata += '<div class="form-group">';
				htmldata += '<label>Device ID</label>';
				htmldata += '<input type="text" class="form-control" value="' + msg.deviceId + '" disabled="disabled">';
				htmldata += '</div>';
				htmldata += '<div class="form-group">';
				htmldata += '<label>API Key</label>';
				htmldata += '<input type="text" class="form-control" value="' + msg.apikey + '" disabled="disabled">';
				htmldata += '</div>';
				htmldata += '</form>';
				htmldata += '</div></div></div>';
				$('#registeredDevices-content').html(htmldata);
				//deviceData-content
			}

			function getDevices() {
				var url = 'http://ec2-13-59-250-78.us-east-2.compute.amazonaws.com/devices?email=';
				var querystring = encodeURIComponent(userEmail);
				$.ajax({
					type: "GET",
					url: url + querystring,
					dataType: "json",
					success: loadRegistedredDevices,
					error: function (jqXHR) {
						var error = jqXHR.responseJSON.error;
						console.log(error);
					}
				})
			}

			function loadRegistedredDevices(msg) {
				if (msg.devices) {
					$('#Nodevice').hide();
					var count = 0
					for (var i in msg.devices) {
						count++;
						AppendRegisteredDevice(msg.devices[i]);
					}
					if(count == 0){
						$('#Nodevice').show();
					}
				}
				else {
					$('#Nodevice').show();
				}
			}

			function latestDevicedata(){
				var url = 'http://ec2-13-59-250-78.us-east-2.compute.amazonaws.com/devices/latest?deviceId=';
				var querystring = encodeURIComponent(deviceId);
				$.ajax({
					type: "GET",
					url: url + querystring,
					dataType: "json",
					success: loadUVData,
					error: function (jqXHR) {
						var error = jqXHR.responseJSON.error;
						console.log(error);
					}
				})

			}

			function loadUVData(msg){
				if (msg.data) {
					$('#NodeviceData').hide();
					var count = 0
					for (var i in msg.data) {
						var dData= msg.data[i];
						count++;
						var htmldata = '<div class="col-lg-6 col-sm-6"><div class="card"><div class="container-fluid" style="padding: 15px">';
						htmldata += '<form>';
						htmldata += '<div class="form-group">';
						htmldata += '<label>Latitude</label>';
						htmldata += '<input type="text" class="form-control" value="' + dData.latitude + '" disabled="disabled">';
						htmldata += '</div>';
						htmldata += '<div class="form-group">';
						htmldata += '<label>Longitude</label>';
						htmldata += '<input type="text" class="form-control" value="' + dData.longitude + '" disabled="disabled">';
						htmldata += '</div>';
						htmldata += '<div class="form-group">';
						htmldata += '<label>UV Exposure</label>';
						htmldata += '<input type="text" class="form-control" value="' + dData.uv + '" disabled="disabled">';
						htmldata += '</div>';
						htmldata += '</form>';
						htmldata += '</div></div></div>';
						$('#deviceData-content').append(htmldata);
					}
					if(count == 0){
						$('#NodeviceData').show();
					}
				}
				else {
					$('#NodeviceData').show();
				}
			}

		</script>
	</body>

</html>