<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
		<meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0' name='viewport' />
		<meta name="viewport" content="width=device-width" />
		<title>SunSmart</title>

		<!--  Fonts and icons     -->
		<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" />
		<link href="/stylesheets/animate.css" rel="stylesheet" />
		<link href="/stylesheets/paper-dashboard.css" rel="stylesheet" />
		<link href="https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css" rel="stylesheet">
		<link href='https://fonts.googleapis.com/css?family=Muli:400,300' rel='stylesheet' type='text/css'>
		<link href="/stylesheets/themify-icons.css" rel="stylesheet">
		<link href="/stylesheets/index.css" rel="stylesheet">

		<!--   Core JS Files   -->
		<script src="https://code.jquery.com/jquery-3.2.1.js" type="text/javascript"></script>
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" type="text/javascript"></script>

	</head>
	<body>
		<div class="wrapper">
			<div class="sidebar" data-background-color="black" data-active-color="danger">
				<div class="sidebar-wrapper">
					<div class="logo">
						<a href="javascript:window.location.reload()" class="simple-text">
							SunSmart
						</a>
					</div>
					<ul id="menu" class="nav">
						<li id="dashboard" class="da1  active" onclick="changeView(this)">
							<a href="javascript:void(0)">
								<i class="ti-panel"></i>
								<p>Dashboard</p>
							</a>
						</li>
						<li id="devices" class="da2" onclick="changeView(this)">
							<a href="javascript:void(0)">
								<i class="ti-mobile"></i>
								<p>Devices</p>
							</a>
						</li>
						<li id="uvindex" class="da3" onclick="changeView(this)">
							<a href="javascript:void(0)">
								<i class="ti-shine"></i>
								<p>UV Index</p>
							</a>
						</li>
						<li id="healthtips" class="da4" onclick="changeView(this)">
							<a href="javascript:void(0)">
								<i class="ti-info"></i>
								<p>Health Tips</p>
							</a>
						</li>
						<li id="userprofile" class="da5" onclick="changeView(this)">
							<a href="javascript:void(0)">
								<i class="ti-user"></i>
								<p>User Profile</p>
							</a>
						</li>
						<li id="weatherforcast" class="da6" onclick="changeView(this)">
							<a href="javascript:void(0)">
								<i class="ti-user"></i>
								<p>Weather Forcast</p>
							</a>
						</li>						
					</ul>
				</div>
			</div>

			<div class="main-panel">
				<nav class="navbar navbar-default">
					<div class="container-fluid">
						<div class="navbar-header">
							<button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#menu-collapse">
								<span class="sr-only">Toggle navigation</span>
								<span class="icon-bar bar1"></span>
								<span class="icon-bar bar2"></span>
								<span class="icon-bar bar3"></span>
							</button>
							<a id="navhead" class="navbar-brand" href="javascript:void(0)"></a>
						</div>
						<div id="menu-collapse" class="collapse navbar-collapse">
							<ul class="nav navbar-nav navbar-right">
								<li id="logoutli">
									<a href="javascript:void(0)">
										<i class="ti-panel"></i>
										<p>Logout</p>
									</a>
								</li>
							</ul>
						</div>
					</div>
				</nav>

				<div class="content">
					<div class="container-fluid">

						<div id="dashboard-content">
							<div class="row">
								<div class="col-lg-4 col-sm-4">
									<div class="card">
										<div class="content">
											<div class="row">
												<div class="col-xs-5">
													<div class="icon-big icon-warning text-center" id="device">
													</div>
												</div>
												<div class="col-xs-7">
													<div class="numbers">
														<p>DEVICES</p>
													</div>
												</div>
											</div>
											<div class="footer">
												<hr />
												<div class="stats">
													<button class="btn btn-dashboard" onclick="change(1)">Get Started</button>
												</div>
											</div>
										</div>
									</div>
								</div>
								<div class="col-lg-4 col-sm-4">
									<div class="card">
										<div class="content">
											<div class="row">
												<div class="col-xs-5">
													<div class="icon-big icon-success text-center" id="uvcard">
													</div>
												</div>
												<div class="col-xs-7">
													<div class="numbers">
														<p>UV INDEX</p>
													</div>
												</div>
											</div>
											<div class="footer">
												<hr />
												<div class="stats">
													<button class="btn btn-dashboard" onclick="change(2)">Get UV Index</button>
												</div>
											</div>
										</div>
									</div>
								</div>
								<div class="col-lg-4 col-sm-4">
									<div class="card">
										<div class="content">
											<div class="row">
												<div class="col-xs-5">
													<div class="icon-big icon-danger text-center" id="healthtip">
														<i></i>
													</div>
												</div>
												<div class="col-xs-7">
													<div class="numbers">
														<p>HEALTH TIPS!</p>
													</div>
												</div>
											</div>
											<div class="footer">
												<hr />
												<div class="stats">
													<button class="btn btn-dashboard" onclick="change(3)">Get Health Tips</button>
												</div>
											</div>
										</div>
									</div>
								</div>
								<div class="col-lg-4 col-sm-4">
									<div class="card">
										<div class="content">
											<div class="row">
												<div class="col-xs-5">
													<div class="icon-big icon-info text-center" id="profile">
													</div>
												</div>
												<div class="col-xs-7">
													<div class="numbers">
														<p>USER PROFILE</p>
													</div>
												</div>
											</div>
											<div class="footer">
												<hr />
												<div class="stats">
													<button class="btn btn-dashboard" onclick="change(4)">My Profile</button>
												</div>
											</div>
										</div>
									</div>
								</div>
								<div class="col-lg-4 col-sm-4">
									<div class="card">
										<div class="content">
											<div class="row">
												<div class="col-xs-5">
													<div class="icon-big icon-info text-center" id="forecastcard">
													</div>
												</div>
												<div class="col-xs-7">
													<div class="numbers">
														<p>WEATHER FORECAST</p>
													</div>
												</div>
											</div>
											<div class="footer">
												<hr />
												<div class="stats">
													<button class="btn btn-dashboard" onclick="change(5)">Get Forecast</button>
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>

						<div id="devices-content" style="display:none">
							<div class="row">
								<div id="Nodevice">
									<div class="row">
										<div class="col-lg-6 col-sm-6">
											<div class="card">
												<div class="container-fluid" style="padding: 25px">
													<strong>No Devices Found. Please Add a device to get started.</strong>
												</div>
											</div>
										</div>
									</div>
								</div>
								<div id="registeredDevices">
									<div class="row" id="registeredDevices-content">
									</div>
								</div>
							</div>
							<div class="row" style="text-align: center">
								<button id="addDeviceBtn" type="button" class="btn btn-info" data-toggle="modal" data-target="#registerModal">Add Device</button>
							</div>
						</div>

						<div id="uvindex-content" style="display:none">
							<div class="row">
								<div id="NodeviceData">
									<div class="row">
										<div class="col-lg-6 col-sm-6">
											<div class="card">
												<div class="container-fluid" style="padding: 25px">
													<strong>No Device-data Found. Please Add a device to get started.</strong>
												</div>
											</div>
										</div>
									</div>
								</div>
								<div id="deviceData">
									<div class="row" id="deviceData-content">
									</div>
								</div>
							</div>
							<div class="row" style="text-align: center">
								<button id="getLatestBtn" type="button" class="btn btn-info" onclick="latestDevicedata()">Get Latest Data</button>
							</div>
						</div>

						<div id="healthtips-content" style="display:none">
							<div class="row">
								<div class="col-lg-6 col-sm-6">
									<div class="card">
										<div class="header">
											Health tips.
										</div>
										<div class="content">
											<p>
												Health tips links.
											</p>
										</div>
									</div>
								</div>
							</div>
						</div>

						<div id="userprofile-content" style="display:none">						
							<div class="row">
								<div class="col-lg-6 col-sm-6">
									<div class="card">
										<div class="header">
											User Details
										</div>
										<div class="content">
										</div>
									</div>
								</div>
							</div>
						</div>

						<div id="weatherforcast-content" style="display:none">						
							<div class="row">
								<div class="col-lg-5 col-sm-5">
									<div class="card">
										<div class="header">
											<div class="form-group">
												<Label for="zip_code">ZIP Code</Label>
												<input id="zip_code" type="text" class="form-control" pattern="[0-9]{5}" placeholder="Enter the 5 digit zip code"/> 
											</div>
											<br>
											<button type="button" class="btn btn-default" id="forecastBtn" >Get Weather Forecast!</button>
										</div>
										<div class="content">
										</div>
									</div>
								</div>
							</div>
							
							<div class="row" id="forecastDataCards">								
							</div>							
						</div>
						
					</div>
				</div>

				<!-- Here comes the footer-->
				<footer class="footer">
					<div class="container-fluid">
						<nav class="pull-left">
							<ul>
								<li>
									<a href="https://github.com/Ganeshr93">
										GitHub
									</a>
								</li>
							</ul>
						</nav>
						<div class="copyright pull-right">
							&copy;
							<script>document.write(new Date().getFullYear())</script>, made with <i class="fa fa-heart heart"></i> by SunSmart Inc
						</div>
					</div>
				</footer>
			</div>
		</div>

		<!-- Modal for Register Device-->
		<div id="registerModal" class="modal fade" role="dialog">
			<div class="modal-dialog modal-sm">
				<!-- Modal content-->
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal">&times;</button>
						<h4 class="modal-title">Device register form</h4>
					</div>
					<div class="modal-body">
						<form>
							<div class="form-group">
								<label for="deviceid">DeviceID</label>
								<input name="deviceid" type="text" class="form-control" id="deviceid" placeholder="Device Id" required="required">
							</div>
							<div id="registerdevice-error" style="color: red; margin: 3px 0px 3px 0px">
							</div>
							<button type="button" id="register-submit" class="btn btn-primary">Submit</button>
							<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
						</form>
					</div>
					<div class="modal-footer">
					</div>
				</div>
			</div>
		</div>
		
		<div style="display: none">
			<form id="logoutForm" action="/users/logout" method="post">
				<input name="username" type="password" id="logoutInput">
			</form>
		</div>
		
		<script src="/js/paper-dashboard.js"></script>

		<script>
			var userEmail = '{{{email}}}';
			var deviceId = '';
			var authToken='{{{authToken}}}';
			var username= '{{{username}}}';
			var devicesList= [];
			$(document).ready(function () {
				if(authToken != ''){
					window.localStorage.setItem("authToken", authToken);
				}
				else{
					console.log("Auth Token is Empty");
				}
				loadContent();
				getDevices();
				if(devicesList.length > 0){
					//latestDevicedata();
				}
			});

			function change(x) {
				if(x==1) {
					var element = document.getElementById("devices");
					changeView(element);
				}
				else if(x==2) {
					var element = document.getElementById("uvindex");
					changeView(element);
				}
				else if(x==3) {
					var element = document.getElementById("healthtips");
					changeView(element);
				}
				else if(x==4) {
					var element = document.getElementById("userprofile");
					changeView(element);
				}
				else if(x==5) {
					var element = document.getElementById("weatherforcast");
					changeView(element);
				}
			}

			function changeView(event) {
				var listactive = document.getElementsByClassName('active');

				if (listactive.length > 0) {
					var flagActive = true;
					while (flagActive) {
						listactive = document.getElementsByClassName('active');
						for (var i = 0; i < listactive.length; i++) {
							listactive[i].className = listactive[i].className.replace(/\active\b/g, "");
						}

						var isEmpty = document.getElementsByClassName('active');
						if (isEmpty.length == 0) {
							flagActive = false;
						}
					}
				}

				var classes = document.getElementsByClassName(event.className.split(' ')[0]);
				for (var i = 0; i < classes.length; i++) {
					classes[i].className += " active";
				}

				loadContent(event.id);
			}

			function loadContent(id) {
				switch (id) {
					case 'dashboard':
                    $('#devices-content').hide();
                    $('#userprofile-content').hide();
                    $('#uvindex-content').hide();
                    $('#healthtips-content').hide();
					$('#weatherforcast-content').hide();
                    $('#dashboard-content').show();
					document.getElementById("navhead").innerHTML = "DASHBOARD";
                    break;
					case 'devices':
                    $('#dashboard-content').hide();
                    $('#userprofile-content').hide();
                    $('#uvindex-content').hide();
                    $('#healthtips-content').hide();
					$('#weatherforcast-content').hide();
                    $('#devices-content').show();
					document.getElementById("navhead").innerHTML = "DEVICES";
                    break;
					case 'healthtips':
                    $('#devices-content').hide();
                    $('#dashboard-content').hide();
                    $('#uvindex-content').hide();
                    $('#userprofile-content').hide();
					$('#weatherforcast-content').hide();
                    $('#healthtips-content').show();
					document.getElementById("navhead").innerHTML = "HEALTH TIPS";
                    break;
					case 'uvindex':
                    $('#devices-content').hide();
                    $('#dashboard-content').hide();
                    $('#healthtips-content').hide();
                    $('#userprofile-content').hide();
					$('#weatherforcast-content').hide();
                    $('#uvindex-content').show();
					document.getElementById("navhead").innerHTML = "UV INDEX";
                    break;
					case 'userprofile':
					getUserDetails();
                    $('#devices-content').hide();
                    $('#dashboard-content').hide();
                    $('#uvindex-content').hide();
                    $('#healthtips-content').hide();
					$('#weatherforcast-content').hide();
                    $('#userprofile-content').show();
					document.getElementById("navhead").innerHTML = "USER PROFILE";
                    break;
					case 'weatherforcast':
                    $('#devices-content').hide();
                    $('#dashboard-content').hide();
                    $('#uvindex-content').hide();
                    $('#healthtips-content').hide();
                    $('#userprofile-content').hide();
					$('#weatherforcast-content').show();
					document.getElementById("navhead").innerHTML = "WEATHER FORECAST";
                    break;
					default:
                    $('#devices-content').hide();
                    $('#userprofile-content').hide();
                    $('#uvindex-content').hide();
                    $('#healthtips-content').hide();
					$('#weatherforcast-content').hide();
                    $('#dashboard-content').show();
					document.getElementById("navhead").innerHTML = "DASHBOARD";
				}
			}

			$('#addDeviceBtn').on('click', function () {
				$('#registerdevice-error').html('');
				$("#deviceid").val('');
			});
			
			$("#forecastBtn").click(function() {
				var zip_code = $("#zip_code").val();
				var url = "/forecast?postal_code=";
				var querystring = encodeURIComponent(zip_code);
				$.ajax({
					type: "GET",
					url: url + querystring,
					responseType: "json",
					success: forecast,
					error: function (jqXHR, status, error) {
							console.log(jqXHR.responseJSON);
					}
				});
			});
			
			function forecast(data, status, xhr) {
				var finaldata= data["uv"];
				var htmlData='';
				for(var i in finaldata) {
					htmlData+='<div class="col-lg-5 col-sm-5">';
					htmlData+='<div class="card">';
					htmlData+='<ul>';
					htmlData+='<li> UV: '+ finaldata[i].uv +'</li>';
					htmlData+='<li> Max Temperature: '+ finaldata[i].max_temp+'</li>';
					htmlData+='<li> Min Temperature: '+ finaldata[i].min_temp+'</li>';
					htmlData+='<li> Precipitation: '+ finaldata[i].precip+'</li>';
					htmlData+='<li> Date :'+ finaldata[i].date+'</li>';
					htmlData+='</ul>';
					htmlData+='</div>';
					htmlData+='</div>';
				}
				$('#forecastDataCards').html(htmlData);
			}			

			$('#register-submit').on('click', function () {
				var url = '/register';
				var data = {
					deviceId: $("#deviceid").val(),
					email: userEmail
				}

				$.ajax({
					type: "POST",
					url: url,
					dataType: "json",
					data: data,
					success: AppendRegisteredDevice,
					error: function (jqXHR) {
						var error = jqXHR.responseJSON.error;
						$('#registerdevice-error').html(error);
					}
				});

				deviceId=$("#deviceid").val();
			});

			function AppendRegisteredDevice(msg) {
				//Update devices list
				devicesList.push(msg.deviceId);
				deviceId=msg.deviceId; //TODO: Need to modify this.
				$('#registerModal').modal('hide');
				$('#Nodevice').hide();
				var htmldata = '<div id="' + msg.deviceId + '"><div class="col-lg-6 col-sm-6"><div class="card"><div class="container-fluid" style="padding: 15px">';
				htmldata += '<form>';
				htmldata += '<div class="form-group">';
				htmldata += '<label>Device ID</label>';
				htmldata += '<input type="text" class="form-control" value="' + msg.deviceId + '" disabled="disabled">';
				htmldata += '</div>';
				htmldata += '<div class="form-group">';
				htmldata += '<label>API Key</label>';
				htmldata += '<input type="text" class="form-control" value="' + msg.apikey + '" disabled="disabled">';
				htmldata += '</div>';
				htmldata += '</form>';
				htmldata += '<button class="btn" id="' + msg.deviceId + '!#!btn" onclick="DeleteDevice(this)">Delete Device</button>';
				htmldata += '</div></div></div></div>';
				$('#registeredDevices-content').append(htmldata);
				
			}
			
			function DeleteDevice(element){
				var devId = element.id.split('!#!')[0];
				var url = '/deleteDevice';
				var data = {
					deviceId: devId,
					email: userEmail
				}
			
				$.ajax({
					type: "POST",
					url: url,
					dataType: "json",
					data: data,
					success: function(msg){
								var index = devicesList.indexOf(devId);
								if (index > -1) {
									devicesList.splice(index, 1);
								}
								$("#"+devId).remove();
								//console.log("Device "+ devId + " is now deleted");
					},
					error: function (jqXHR) {
						var error = jqXHR.responseJSON.error;
						console.log(error);
					}
				});
			}
			

			function getDevices() {
				var url = '/devices?email=';
				var querystring = encodeURIComponent(userEmail);
				$.ajax({
					type: "GET",
					url: url + querystring,
					dataType: "json",
					success: loadRegistedredDevices,
					error: function (jqXHR) {
						var error = jqXHR.responseJSON.error;
						console.log(error);
					}
				})
			}

			function loadRegistedredDevices(msg) {
				if (msg.devices) {
					$('#Nodevice').hide();
					devicesList=[];
					for (var i in msg.devices) {
						AppendRegisteredDevice(msg.devices[i]);
					}					
					//console.log(devicesList);
					if(devicesList.length == 0){
						$('#Nodevice').show();
					}else{
						//Start loading UV data from devices					
					}
				}
				else {
					$('#Nodevice').show();
				}
			}
			
			
			function latestDevicedata(){				
				var url = '/getDeviceData?email=';
				var querystring = encodeURIComponent(userEmail);
				$.ajax({
					type: "GET",
					url: url + querystring,
					dataType: "json",
					success: loadUVData,
					error: function (jqXHR) {
						var error = jqXHR.responseJSON.error;
						console.log(error);
					}
				});
			}
			
			function loadUVData(msg){
				console.log(msg);			
			}

			function latestDevicedata123(){	//TODO Use this later			
				var url = '/deviceData/latest?deviceId=';
				var querystring = encodeURIComponent(devicesList[0]);
				$.ajax({
					type: "GET",
					url: url + querystring,
					dataType: "json",
					success: loadUVData123,
					error: function (jqXHR) {
						var error = jqXHR.responseJSON.error;
						console.log(error);
					}
				});
			}
		
			
			function loadUVData123(msg){
				//console.log(msg.data)
				if (msg.data) {
					$('#NodeviceData').hide();
					var htmldata = '<div class="col-lg-6 col-sm-6"><div class="card"><div class="container-fluid" style="padding: 15px">';
					htmldata += '<form>';
					htmldata += '<div class="form-group">';
					htmldata += '<label>Latitude</label>';
					htmldata += '<input type="text" class="form-control" value="' + msg.data.latitude + '" disabled="disabled">';
					htmldata += '</div>';
					htmldata += '<div class="form-group">';
					htmldata += '<label>Longitude</label>';
					htmldata += '<input type="text" class="form-control" value="' + msg.data.longitude + '" disabled="disabled">';
					htmldata += '</div>';
					htmldata += '<div class="form-group">';
					htmldata += '<label>UV Exposure</label>';
					htmldata += '<input type="text" class="form-control" value="' + msg.data.uv + '" disabled="disabled">';
					htmldata += '</div>';
					htmldata += '<div class="form-group">';
					htmldata += '<label>Time</label>';
					htmldata += '<input type="text" class="form-control" value="' + msg.data.time + '" disabled="disabled">';
					htmldata += '</div>';
					htmldata += '</form>';
					htmldata += '</div></div></div>';
					$('#deviceData-content').html(htmldata);
				}
				else {
					$('#NodeviceData').show();
				}
			}
			
			
			function getUserDetails(){
				var url = '/userDetails?email=';
				var querystring = userEmail;
				$.ajax({
					type: "GET",
					url: url + querystring,
					dataType: "json",
					success: handleUserData,
					error: function (jqXHR) {
						var error = jqXHR.responseJSON.error;
						console.log(error);
					}
				});				
			}


			function handleUserData(data) {
				var _name = data.name;
				var _email = data.email;
				var htmldata = '<div class="col-lg-6 col-sm-10"><div class="card"><div class="container-fluid" style="padding: 15px">';
				htmldata += '<form class="form-horizontal" >';
				htmldata += '<div class="form-group">';
				htmldata += '<label class="control-label col-sm-3">Name:</label>';
				htmldata += '<div class="col-sm-8">'
				htmldata += '<input type="text" id="editName" class="form-control" value="' + _name + '" disabled="disabled">';
				htmldata += '</div>';
				htmldata += '</div>';
				htmldata += '<div class="form-group">';
				htmldata += '<label class="control-label col-sm-3">Email:</label>';
				htmldata += '<div class="col-sm-8">'
				htmldata += '<input type="text" id="editEmail" class="form-control" value="' + _email + '" disabled="disabled">';
				htmldata += '</div>';
				htmldata += '</div>';
				htmldata += '<div class="form-group">';
				htmldata += '<label class="control-label col-sm-3">Old Password:</label>';
				htmldata += '<div class="col-sm-8">'
				htmldata += '<input type="password" id="old-pwd" class="form-control" placeholder="Enter Old Password" disabled="disabled">';
				htmldata += '</div>';
				htmldata += '</div>';
				htmldata += '<div class="form-group">';
				htmldata += '<label class="control-label col-sm-3">New Password:</label>';
				htmldata += '<div class="col-sm-8">'
				htmldata += '<input type="password" id="new-pwd" class="form-control" placeholder="Enter New Password" disabled="disabled">';
				htmldata += '</div>';
				htmldata += '</div>';
				htmldata += '<div class= "col-sm-offset-3 col-sm-8"><div id="updateMessage" style="display : none"></div></div>'
				htmldata += '<div class="form-group">';
				htmldata += '<div class="col-sm-offset-2 col-sm-10">';
				htmldata += '<div class="btn-toolbar">'
				htmldata += '<button type="button" class="btn btn-default" id="userDetailsEdit">Edit</button>';
				htmldata += '<button type="button" class="btn btn-default" id="userDetailsUpdate" disabled>Update</button>';
				htmldata += '</div>';
				htmldata += '</div>';
				htmldata += '</div>';
				htmldata += '</form>';
				htmldata += '</div></div></div>';
				$('#userprofile-content').html(htmldata);
			}

			$(document).on('click', '#userDetailsEdit', function() {
				$("#userDetailsUpdate").attr("disabled", false);
				$("#editEmail").attr("disabled", false);
				$("#editName").attr("disabled", false);
				$("#old-pwd").attr("disabled", false);
				$("#new-pwd").attr("disabled", false);
			});

			$(document).on('click', '#userDetailsUpdate', function() {
				var _name = $('#editName').val();
				var _email = $('#editEmail').val();
				var _oldpwd = $('#old-pwd').val();
				var _newpwd = $('#new-pwd').val();
				//console.log("name: " + _name + ", email: " + _email + ", old email: " + userEmail);


				var updatedData = {name : _name, new_email : _email, old_pwd : _oldpwd, new_pwd : _newpwd, old_email : userEmail};
				var url = '/updateUserDetails';
				$.ajax({
					type: "POST",
					url: url,
					dataType: "json",
					data: updatedData,
					success: updateConfirmation,
					error: function (jqXHR) {
						var error = jqXHR.responseJSON.error;
						console.log("ERROR: " + error);
					}
				});
			});

			function updateConfirmation(data){
				var message = data.message;
				
				var updMsg = document.getElementById('updateMessage');
				updMsg.innerHTML = message;
				if(data.updated == true){
					userEmail = _email; //Updated user email ID
					updMsg.style.color = "green";
					updMsg.style.display = "block";
					$("#userDetailsUpdate").attr("disabled", true);
					$("#editEmail").attr("disabled", true);
					$("#editName").attr("disabled", true);
					$("#old-pwd").attr("disabled", true);
					$("#new-pwd").attr("disabled", true);
				}
				else{
					updMsg.style.color = "red";
					updMsg.style.display = "block";
					$("#userDetailsUpdate").attr("disabled", false);
					$("#editEmail").attr("disabled", false);
					$("#editName").attr("disabled", false);
					$("#old-pwd").attr("disabled", false);
					$("#new-pwd").attr("disabled", false);
					$('#old-pwd').val('');
					$('#new-pwd').val('');
				}
			}
			
			$('#logoutli').click(function() {
				$('#logoutInput').val(username);
				$('#logoutForm').submit();		
			});

		</script>
	</body>

</html>
